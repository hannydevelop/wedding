<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIRS - Revenue Collection</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --sidebar-bg: #2c3e50;
            --sidebar-width: 250px;
            --header-height: 70px;
            --primary-color: #5bc0de;
            --text-muted: #95a5a6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            overflow-x: hidden;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: var(--sidebar-width);
            background-color: var(--sidebar-bg);
            color: white;
            transition: transform 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar:not(.show) {
            transform: translateX(-100%);
        }

        @media (min-width: 993px) {
            .sidebar {
                z-index: 100;
            }
        }

        .sidebar-logo {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .sidebar-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
            transition: color 0.3s;
        }

        .sidebar-close:hover {
            color: var(--primary-color);
        }

        .sidebar-logo img {
            width: 40px;
            height: 40px;
        }

        .sidebar-logo-text {
            display: flex;
            flex-direction: column;
        }

        .sidebar-logo-text .main {
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .sidebar-logo-text .sub {
            font-size: 8px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .sidebar-user {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-user i {
            font-size: 24px;
            color: var(--primary-color);
        }

        .sidebar-user span {
            color: var(--primary-color);
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            transition: background 0.3s;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu .submenu {
            list-style: none;
            padding-left: 50px;
        }

        .sidebar-menu .submenu a {
            padding: 8px 20px;
            font-size: 14px;
            color: var(--text-muted);
        }

        /* Main Content */
        .main-content {
            margin-left: 0;
            transition: margin-left 0.3s ease;
        }

        .main-content.with-sidebar {
            margin-left: var(--sidebar-width);
        }

        @media (max-width: 992px) {
            .main-content {
                margin-left: 0 !important;
            }
        }

        /* Header */
        .header {
            background-color: white;
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #333;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .apps-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            width: 30px;
            height: 30px;
            cursor: pointer;
        }

        .apps-grid span {
            width: 8px;
            height: 8px;
            background-color: var(--primary-color);
            border-radius: 2px;
        }

        /* Content Area */
        .content-area {
            padding: 30px;
        }

        .card-custom {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Tabs */
        .nav-tabs-custom {
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
        }

        .nav-tabs-custom .nav-link {
            border: none;
            color: #666;
            padding: 15px 30px;
            position: relative;
        }

        .nav-tabs-custom .nav-link.active {
            color: var(--primary-color);
            background: none;
        }

        .nav-tabs-custom .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background-color: var(--primary-color);
        }

        /* Progress Bar */
        .progress-custom {
            height: 8px;
            border-radius: 10px;
            margin-bottom: 30px;
            transition: background 0.3s ease;
        }

        /* Summary Styles */
        .summary-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .summary-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-weight: 500;
            color: #666;
        }

        .summary-value {
            font-weight: 600;
            color: #333;
        }

        .summary-total {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .summary-total .summary-row {
            border-bottom: none;
        }

        .summary-total .summary-label,
        .summary-total .summary-value {
            color: white;
            font-size: 18px;
        }

        /* Form Styles */
        .form-label {
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
        }

        .form-select,
        .form-control {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px 15px;
        }

        .form-select:focus,
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(91, 192, 222, 0.25);
        }

        /* Buttons */
        .btn-nav {
            padding: 10px 30px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-nav:hover {
            background-color: #f8f9fa;
        }

        .btn-next {
            background-color: var(--primary-color);
            color: white;
            border: 1px solid var(--primary-color);
        }

        .btn-next:hover {
            background-color: #4aa3c1;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .content-area {
                padding: 15px;
            }

            .card-custom {
                padding: 20px;
            }

            .header {
                padding: 0 15px;
            }
        }

        /* Overlay for mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        @media (max-width: 992px) {
            .sidebar-overlay.show {
                display: block;
            }
        }
    </style>
</head>

<body>
    <div id="app">
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" :class="{ show: sidebarOpen }" @click="toggleSidebar"></div>

        <!-- Sidebar -->
        <aside class="sidebar" :class="{ show: sidebarOpen }">
            <div class="sidebar-logo">
                <i class="fas fa-sun" style="font-size: 40px; color: #f39c12;"></i>
                <div class="sidebar-logo-text">
                    <span class="main">RIRS</span>
                    <span class="sub">Test Revenue Service</span>
                </div>
                <button class="sidebar-close" @click="toggleSidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="sidebar-user">
                <i class="fas fa-user-circle"></i>
                <span>{{ userName }}</span>
            </div>

            <ul class="sidebar-menu">
                <li>
                    <a href="#" :class="{ active: currentSection === 'make-payments' }"
                        @click.prevent="currentSection = 'make-payments'; currentTab = 'payments'">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Make Payments</span>
                    </a>
                </li>
                <li>
                    <a href="#" :class="{ active: currentSection === 'receipts' }"
                        @click.prevent="currentSection = 'receipts'">
                        <i class="fas fa-receipt"></i>
                        <span>My Receipts</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content" :class="{ 'with-sidebar': sidebarOpen }">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="menu-toggle" @click="toggleSidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Make Payments Section -->
                <div class="card-custom" v-if="currentSection === 'make-payments'">
                    <!-- Tabs -->
                    <ul class="nav nav-tabs-custom">
                        <li class="nav-item">
                            <a class="nav-link" :class="{ active: currentTab === 'payments' }"
                                @click.prevent="currentTab = 'payments'" href="#">
                                <i class="fas fa-credit-card me-2"></i>Payments
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" :class="{ active: currentTab === 'confirm' }"
                                @click.prevent="currentTab = 'confirm'" href="#">
                                <i class="far fa-check-square me-2"></i>Confirm
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" :class="{ active: currentTab === 'pay' }"
                                @click.prevent="currentTab = 'pay'" href="#">
                                <i class="fas fa-bell me-2"></i>Pay
                            </a>
                        </li>
                    </ul>

                    <!-- Progress Bar -->
                    <div class="progress-custom" :style="{ background: progressGradient }"></div>

                    <!-- Form -->
                    <form v-if="currentTab === 'payments'">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="form-label">Payment Category</label>
                                <select class="form-select" v-model="paymentCategory">
                                    <option value="licences">Licences</option>
                                    <option value="taxes">Taxes</option>
                                    <option value="fees">Fees</option>
                                </select>
                            </div>

                            <div class="col-md-3 mb-4">
                                <label class="form-label">Payment Type</label>
                                <select class="form-select" v-model="paymentType">
                                    <option value="building">BUILDING PLAN INSPECTION</option>
                                    <option value="business">Business Premises</option>
                                    <option value="motor">Motor Vehicle</option>
                                </select>
                            </div>

                            <div class="col-md-3 mb-4">
                                <label class="form-label">Amount</label>
                                <input type="number" class="form-control" v-model="amount">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="form-label">Period Covered</label>
                                <input type="text" class="form-control" v-model="periodCovered" placeholder="YYYY-MM">
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="d-flex justify-content-end gap-3 mt-5">
                            <button type="button" class="btn-nav" disabled>Previous</button>
                            <button type="button" class="btn-nav btn-next" @click="goToConfirm">Next</button>
                        </div>
                    </form>

                    <!-- Confirm Tab -->
                    <div v-if="currentTab === 'confirm'">
                        <div class="summary-section">
                            <h3 class="summary-title">Payment Summary</h3>

                            <div class="summary-row">
                                <span class="summary-label">Payment Category:</span>
                                <span class="summary-value">{{ paymentCategoryDisplay }}</span>
                            </div>

                            <div class="summary-row">
                                <span class="summary-label">Payment Type:</span>
                                <span class="summary-value">{{ paymentTypeDisplay }}</span>
                            </div>

                            <div class="summary-row">
                                <span class="summary-label">Period Covered:</span>
                                <span class="summary-value">{{ periodCovered }}</span>
                            </div>

                            <div class="summary-total">
                                <div class="summary-row">
                                    <span class="summary-label">Total Amount:</span>
                                    <span class="summary-value">₦{{ formatAmount(amount) }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="d-flex justify-content-end gap-3 mt-5">
                            <button type="button" class="btn-nav" @click="currentTab = 'payments'">Previous</button>
                            <button type="button" class="btn-nav btn-next" @click="goToPay">Next</button>
                        </div>
                    </div>

                    <!-- Pay Tab -->
                    <div v-if="currentTab === 'pay'">
                        <div class="text-center py-5">
                            <i class="fas fa-check-circle" style="font-size: 80px; color: var(--primary-color);"></i>
                            <h3 class="mt-4">Complete Your Payment</h3>
                            <p class="text-muted mb-4">Please select your payment method to proceed</p>

                            <div class="summary-section text-start">
                                <h4 class="mb-3">Payment Details</h4>
                                <div class="summary-row">
                                    <span class="summary-label">Amount to Pay:</span>
                                    <span class="summary-value">₦{{ formatAmount(amount) }}</span>
                                </div>
                            </div>

                            <div class="row mt-4">
                                <div class="col-md-6 mb-3">
                                    <button @click="payWithPaystack" class="btn btn-outline-primary w-100 py-3">
                                        <i class="fas fa-credit-card fa-2x mb-2"></i>
                                        <div>Card Payment</div>
                                    </button>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <button @click="payWithBankTransfer" class="btn btn-outline-primary w-100 py-3">
                                        <i class="fas fa-university fa-2x mb-2"></i>
                                        <div>Bank Transfer</div>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="d-flex justify-content-end gap-3 mt-5">
                            <button type="button" class="btn-nav" @click="currentTab = 'confirm'">Previous</button>
                        </div>
                    </div>
                </div>

                <!-- Receipts Section -->
                <div class="card-custom" v-if="currentSection === 'receipts'">
                    <h2 class="mb-4">My Receipts</h2>

                    <div v-if="transactions.length === 0" class="text-center py-5">
                        <i class="fas fa-receipt" style="font-size: 80px; color: #ccc;"></i>
                        <h4 class="mt-4 text-muted">No receipts yet</h4>
                        <p class="text-muted">Your payment receipts will appear here</p>
                        <button @click="currentSection = 'make-payments'" class="btn btn-outline-primary mt-3">Make a
                            Payment</button>
                    </div>

                    <div v-else class="row">
                        <div v-for="transaction in transactions" :key="transaction.id" class="col-md-6 mb-4">
                            <div class="card border">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-3">
                                        <div>
                                            <h5 class="card-title mb-1">{{ transaction.paymentType }}</h5>
                                            <small class="text-muted">{{ transaction.date }}</small>
                                        </div>
                                        <span class="badge bg-success">Paid</span>
                                    </div>

                                    <div class="mb-2">
                                        <small class="text-muted">Amount:</small>
                                        <div class="fw-bold">₦{{ formatAmount(transaction.amount) }}</div>
                                    </div>

                                    <div class="mb-2">
                                        <small class="text-muted">Reference:</small>
                                        <div class="text-break" style="font-size: 0.9em;">{{ transaction.reference }}
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <small class="text-muted">Payment Method:</small>
                                        <div>{{ transaction.paymentMethod }}</div>
                                    </div>

                                    <button @click="downloadReceipt(transaction)"
                                        class="btn btn-sm btn-outline-primary w-100">
                                        <i class="fas fa-download me-2"></i>Download Receipt
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bank Transfer Modal -->
                <div v-if="showBankModal" class="modal fade show d-block" tabindex="-1"
                    style="background-color: rgba(0,0,0,0.5);">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Bank Transfer Payment</h5>
                                <button type="button" class="btn-close" @click="closeBankModal"></button>
                            </div>
                            <div class="modal-body">
                                <div v-if="loadingBankDetails" class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mt-3">Generating account details...</p>
                                </div>

                                <div v-else-if="bankDetails">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Transfer the exact amount to the account below. Payment will be confirmed
                                        automatically.
                                    </div>

                                    <div class="summary-section">
                                        <div class="summary-row">
                                            <span class="summary-label">Bank Name:</span>
                                            <span class="summary-value">{{ bankDetails.bank_name }}</span>
                                        </div>
                                        <div class="summary-row">
                                            <span class="summary-label">Account Number:</span>
                                            <span class="summary-value">
                                                {{ bankDetails.account_number }}
                                                <button @click="copyToClipboard(bankDetails.account_number)"
                                                    class="btn btn-sm btn-link">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                            </span>
                                        </div>
                                        <div class="summary-row">
                                            <span class="summary-label">Account Name:</span>
                                            <span class="summary-value">{{ bankDetails.account_name }}</span>
                                        </div>
                                        <div class="summary-total">
                                            <div class="summary-row">
                                                <span class="summary-label">Amount:</span>
                                                <span class="summary-value">₦{{ formatAmount(amount) }}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="alert alert-warning mt-3">
                                        <small><i class="fas fa-clock me-2"></i>This account is valid for 24
                                            hours</small>
                                    </div>

                                    <div class="text-center mt-3">
                                        <button @click="checkBankTransferStatus" class="btn btn-primary"
                                            :disabled="checkingStatus">
                                            <span v-if="checkingStatus"
                                                class="spinner-border spinner-border-sm me-2"></span>
                                            {{ checkingStatus ? 'Checking...' : 'I have made the transfer' }}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    sidebarOpen: true,
                    submenuOpen: true,
                    currentSection: 'make-payments', // Changed from 'paye' to 'make-payments'
                    currentTab: 'payments',
                    paymentCategory: 'licences',
                    paymentType: 'building',
                    amount: '1000',
                    periodCovered: '2025-11',
                    transactions: [],
                    showBankModal: false,
                    loadingBankDetails: false,
                    checkingStatus: false,
                    bankDetails: null,
                    currentPaymentRef: null,
                    userName: 'Emmanuel Ukoh',
                    userEmail: 'emmanuel.ukoh@rirs.gov.ng',
                    paystackPublicKey: '', // Replace with your actual Paystack public key
                    paystackSecretKey: '' // Replace with your actual Paystack secret key (use only on server-side in production)
                }
            },
            computed: {
                progressGradient() {
                    const percentage = this.currentTab === 'payments' ? 33 :
                        this.currentTab === 'confirm' ? 66 : 100;
                    return `linear-gradient(to right, var(--primary-color) ${percentage}%, #e0e0e0 ${percentage}%)`;
                },
                paymentCategoryDisplay() {
                    return this.paymentCategory.charAt(0).toUpperCase() + this.paymentCategory.slice(1);
                },
                paymentTypeDisplay() {
                    const types = {
                        'building': 'BUILDING PLAN INSPECTION',
                        'business': 'Business Premises',
                        'motor': 'Motor Vehicle'
                    };
                    return types[this.paymentType] || this.paymentType;
                }
            },
            methods: {
                toggleSidebar() {
                    this.sidebarOpen = !this.sidebarOpen;
                },
                toggleSubmenu() {
                    this.submenuOpen = !this.submenuOpen;
                },
                goToConfirm() {
                    this.currentTab = 'confirm';
                },
                goToPay() {
                    this.currentTab = 'pay';
                },
                formatAmount(amount) {
                    const num = parseFloat(amount) || 0;
                    return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                },
                payWithPaystack() {
                    const self = this;
                    let handler = PaystackPop.setup({
                        key: this.paystackPublicKey,
                        email: this.userEmail,
                        amount: parseFloat(this.amount) * 100,
                        currency: 'NGN',
                        ref: 'RIRS-' + Math.floor((Math.random() * 1000000000) + 1),
                        metadata: {
                            custom_fields: [
                                {
                                    display_name: "Payer Name",
                                    variable_name: "payer_name",
                                    value: self.userName
                                },
                                {
                                    display_name: "Payment Type",
                                    variable_name: "payment_type",
                                    value: self.paymentTypeDisplay
                                },
                                {
                                    display_name: "Payment Category",
                                    variable_name: "payment_category",
                                    value: self.paymentCategoryDisplay
                                },
                                {
                                    display_name: "Period Covered",
                                    variable_name: "period_covered",
                                    value: self.periodCovered
                                }
                            ]
                        },
                        callback: function (response) {
                            // Verify payment on server-side before saving
                            self.verifyPaystackPayment(response.reference, 'Card Payment');
                        },
                        onClose: function () {
                            alert('Transaction was cancelled');
                        }
                    });
                    handler.openIframe();
                },
                async verifyPaystackPayment(reference, paymentMethod) {
                    try {
                        // In production, this should be done on your backend server
                        const response = await fetch(`https://api.paystack.co/transaction/verify/${reference}`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${this.paystackSecretKey}`,
                                'Content-Type': 'application/json'
                            }
                        });

                        const data = await response.json();

                        if (data.status && data.data.status === 'success') {
                            this.saveTransaction(reference, paymentMethod, data.data);
                            alert('Payment successful! Reference: ' + reference);
                            this.currentSection = 'receipts';
                            this.resetForm();
                        } else {
                            alert('Payment verification failed. Please contact support.');
                        }
                    } catch (error) {
                        console.error('Payment verification error:', error);
                        // For demo purposes, save anyway (remove in production)
                        this.saveTransaction(reference, paymentMethod);
                        alert('Payment successful! Reference: ' + reference);
                        this.currentSection = 'receipts';
                        this.resetForm();
                    }
                },
                async payWithBankTransfer() {
                    this.showBankModal = true;
                    this.loadingBankDetails = true;

                    try {
                        // Create dedicated virtual account via Paystack API
                        const response = await fetch('https://api.paystack.co/dedicated_account/assign', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${this.paystackSecretKey}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                email: this.userEmail,
                                first_name: this.userName.split(' ')[0],
                                last_name: this.userName.split(' ').slice(1).join(' '),
                                phone: '+2348012345678', // Add actual phone number
                                preferred_bank: 'wema-bank',
                                country: 'NG'
                            })
                        });

                        const data = await response.json();

                        if (data.status) {
                            this.bankDetails = {
                                bank_name: data.data.bank.name,
                                account_number: data.data.account_number,
                                account_name: data.data.account_name
                            };
                            this.currentPaymentRef = data.data.account_name; // Store for reference
                            this.loadingBankDetails = false;
                        } else {
                            throw new Error('Failed to create virtual account');
                        }
                    } catch (error) {
                        console.error('Bank transfer setup error:', error);
                        // Fallback to demo account for testing
                        this.bankDetails = {
                            bank_name: 'Wema Bank',
                            account_number: '7123456789',
                            account_name: `RIRS/${this.userName.toUpperCase()}`
                        };
                        this.currentPaymentRef = 'RIRS-BANK-' + Math.floor((Math.random() * 1000000000) + 1);
                        this.loadingBankDetails = false;
                        alert('Demo mode: Using test account details');
                    }
                },
                closeBankModal() {
                    this.showBankModal = false;
                    this.bankDetails = null;
                    this.loadingBankDetails = false;
                    this.checkingStatus = false;
                },
                async checkBankTransferStatus() {
                    this.checkingStatus = true;

                    try {
                        // In production, verify the bank transfer with Paystack
                        // Check for transactions on the dedicated virtual account
                        const response = await fetch(`https://api.paystack.co/transaction?customer=${this.userEmail}`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${this.paystackSecretKey}`,
                                'Content-Type': 'application/json'
                            }
                        });

                        const data = await response.json();

                        if (data.status) {
                            // Look for successful transactions matching the amount
                            const matchingTransaction = data.data.find(txn =>
                                txn.amount === parseFloat(this.amount) * 100 &&
                                txn.status === 'success' &&
                                txn.channel === 'dedicated_nuban'
                            );

                            if (matchingTransaction) {
                                this.saveTransaction(matchingTransaction.reference, 'Bank Transfer', matchingTransaction);
                                alert('Payment confirmed! Reference: ' + matchingTransaction.reference);
                                this.closeBankModal();
                                this.currentSection = 'receipts';
                                this.resetForm();
                            } else {
                                alert('Payment not yet confirmed. Please wait a few moments after transferring and try again.');
                            }
                        } else {
                            throw new Error('Failed to verify payment');
                        }
                    } catch (error) {
                        console.error('Payment verification error:', error);
                        // Demo mode fallback
                        const confirmed = confirm('Demo Mode: Has the payment been confirmed?\n\nClick OK to simulate successful payment, or Cancel to keep waiting.');

                        if (confirmed) {
                            this.saveTransaction(this.currentPaymentRef, 'Bank Transfer');
                            alert('Payment confirmed! Reference: ' + this.currentPaymentRef);
                            this.closeBankModal();
                            this.currentSection = 'receipts';
                            this.resetForm();
                        }
                    }

                    this.checkingStatus = false;
                },
                saveTransaction(reference, paymentMethod, paystackData = null) {
                    const transaction = {
                        id: Date.now(),
                        reference: reference,
                        paymentMethod: paymentMethod,
                        paymentType: this.paymentTypeDisplay,
                        paymentCategory: this.paymentCategoryDisplay,
                        amount: this.amount,
                        periodCovered: this.periodCovered,
                        payerName: this.userName,
                        payerEmail: this.userEmail,
                        date: new Date().toLocaleString('en-NG', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        }),
                        timestamp: Date.now(),
                        status: 'Paid',
                        paystackData: paystackData // Store full Paystack response for reference
                    };

                    // Add to current session
                    this.transactions.unshift(transaction);

                    // Save to localStorage
                    const stored = JSON.parse(localStorage.getItem('rirs_transactions') || '[]');
                    stored.unshift(transaction);
                    localStorage.setItem('rirs_transactions', JSON.stringify(stored));

                    console.log('Transaction saved:', transaction);
                },
                resetForm() {
                    this.currentTab = 'payments';
                    this.amount = '1000';
                    this.periodCovered = new Date().toISOString().slice(0, 7);
                },
                downloadReceipt(transaction) {
                    const receiptContent = `
╔═══════════════════════════════════════════════════════════════╗
║       RIVERS STATE INTERNAL REVENUE SERVICE (RIRS)            ║
║                  OFFICIAL PAYMENT RECEIPT                     ║
╚═══════════════════════════════════════════════════════════════╝

Receipt Generated: ${new Date().toLocaleString('en-NG')}
Receipt Date: ${transaction.date}
Payment Reference: ${transaction.reference}

═══════════════════════════════════════════════════════════════
                        PAYER INFORMATION
═══════════════════════════════════════════════════════════════
Payer Name:           ${transaction.payerName || this.userName}
Email Address:        ${transaction.payerEmail || this.userEmail}

═══════════════════════════════════════════════════════════════
                       PAYMENT DETAILS
═══════════════════════════════════════════════════════════════
Payment Category:     ${transaction.paymentCategory}
Payment Type:         ${transaction.paymentType}
Period Covered:       ${transaction.periodCovered}
Payment Method:       ${transaction.paymentMethod}

═══════════════════════════════════════════════════════════════
                        AMOUNT PAID
═══════════════════════════════════════════════════════════════
Total Amount:         ₦${this.formatAmount(transaction.amount)}
Payment Status:       ${transaction.status}

═══════════════════════════════════════════════════════════════

This is an official receipt from Rivers State Internal Revenue 
Service. Please keep this for your records.

For inquiries or verification, contact:
Email: info@rirs.gov.ng
Phone: +234-XXX-XXX-XXXX
Website: www.rirs.gov.ng

Reference Number: ${transaction.reference}
Transaction ID: ${transaction.id}

═══════════════════════════════════════════════════════════════
              Generated via RIRS Online Payment Portal
═══════════════════════════════════════════════════════════════
                    `;

                    const blob = new Blob([receiptContent], { type: 'text/plain' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `RIRS_Receipt_${transaction.reference}_${Date.now()}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                },
                copyToClipboard(text) {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(text).then(() => {
                            alert('Account number copied to clipboard!');
                        }).catch(() => {
                            this.fallbackCopy(text);
                        });
                    } else {
                        this.fallbackCopy(text);
                    }
                },
                fallbackCopy(text) {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        alert('Account number copied: ' + text);
                    } catch (err) {
                        alert('Failed to copy. Please copy manually: ' + text);
                    }
                    document.body.removeChild(textArea);
                },
                loadTransactionsFromStorage() {
                    // Load transactions from localStorage
                    const stored = localStorage.getItem('rirs_transactions');
                    if (stored) {
                        try {
                            this.transactions = JSON.parse(stored);
                            console.log('Loaded transactions from localStorage:', this.transactions.length);
                        } catch (error) {
                            console.error('Error loading transactions:', error);
                            this.transactions = [];
                        }
                    }
                },
                clearAllTransactions() {
                    // Utility method to clear all transactions (for testing)
                    if (confirm('Are you sure you want to clear all transaction history?')) {
                        this.transactions = [];
                        localStorage.removeItem('rirs_transactions');
                        alert('All transactions cleared!');
                    }
                }
            },
            mounted() {
                // Close sidebar by default on mobile
                if (window.innerWidth <= 992) {
                    this.sidebarOpen = false;
                }

                window.addEventListener('resize', () => {
                    if (window.innerWidth <= 992 && this.sidebarOpen) {
                        // Optional: keep sidebar behavior on resize
                    }
                });

                // Load existing transactions from localStorage
                this.loadTransactionsFromStorage();

                // Set default period to current month
                this.periodCovered = new Date().toISOString().slice(0, 7);

                console.log('RIRS Payment System initialized');
                console.log('User:', this.userName);
                console.log('Stored transactions:', this.transactions.length);
            }
        }).mount('#app');
    </script>
</body>

</html>